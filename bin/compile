#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Install bento4"
BUILD_DIR="$1"
VENDOR_DIR="vendor"
GITHUB_URL="https://github.com/DigitalSapphire/heroku-buildpack-bento4-latest.git"

echo "Using buildpack from GitHub URL: $GITHUB_URL" | indent

cd "$BUILD_DIR"
mkdir -p "$VENDOR_DIR"
cd "$VENDOR_DIR"
git clone --quiet "$GITHUB_URL" bento4

echo "exporting PATH" | indent
PROFILE_PATH="$BUILD_DIR/.profile.d/bento4.sh"
mkdir -p "$(dirname "$PROFILE_PATH")"
echo 'export PATH="$PATH:${HOME}/vendor/bento4"' > "$PROFILE_PATH"

echo "-----> Cleaning Up"
echo "removing extra files" | indent
rm -rf bento
